<!DOCTYPE html> <html lang="cs" dir="ltr" itemtype="http://schema.org/WebPage" itemscope=""> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <meta name="HandheldFriendly" content="true"/> <title>Debugujeme v Node.js | fragaria.cz</title> <meta name="author" content="Fragaria s.r.o."/> <meta name="robots" content="index,follow"/> <meta name="description" content="Jakožto nově příchozí do světa Node.js jsem se záhy začal zajímat ozpůsob, jak efektivně ladit kód v Node.js. Donedávna jsem se pohybovalpředevším v prostředí Pythonu, kde jsem byl zvyklý používatpdb. Jaké jsou alternativypro Node.js?"> <meta name="keywords" content="fragaria, software, vývoj software, webové aplikace, python, javascript, angular, elasticsearch, html, css, debug, nodejs"/> <meta property="og:url" content="https://fragaria.github.com/website/blog/2015/05/27/debugujeme-v-nodejs/"/> <meta property="og:type" content="website"/> <meta property="og:title" content="Debugujeme v Node.js | fragaria.cz"/> <meta property="og:description" content="Jakožto nově příchozí do světa Node.js jsem se záhy začal zajímat ozpůsob, jak efektivně ladit kód v Node.js. Donedávna jsem se pohybovalpředevším v prostředí Pythonu, kde jsem byl zvyklý používatpdb. Jaké jsou alternativypro Node.js?"/> <meta property="og:image" content="https://res.cloudinary.com/fragaria/image/upload/w_640,c_fit,f_jpg,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png"/> <link rel="apple-touch-icon" sizes="180x180" href="/website/assets/favicons/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/website/assets/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/website/assets/favicons/favicon-16x16.png"> <link rel="manifest" href="/website/assets/favicons/site.webmanifest"> <link rel="mask-icon" href="/website/assets/favicons/safari-pinned-tab.svg" color="#ea272e"> <link rel="shortcut icon" href="/website/favicon.ico"> <meta name="msapplication-TileColor" content="#ea272e"> <meta name="msapplication-config" content="/website/assets/favicons/browserconfig.xml"> <meta name="theme-color" content="#ea272e"> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/AndulkaTextPro.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/AndulkaTextPro-Italic.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/TriviaGroteskN2-Bold.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="/website/assets/fonts/fragariacz-icons.ttf?msgmt6" as="font" type="font/ttf" crossorigin="anonymous"> <link rel="preload" href="/website/assets/js/site.js?584f23011346b069c187ad61a8021139" as="script"> <link rel="stylesheet" href="/website/assets/styles.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="alternate" type="application/atom+xml" href="/website/feed.xml" title="Atom feed for this page"/> <link rel="self" type="application/atom+xml" href="/website/feed.xml"/> <script type="text/javascript" src="/website/assets/js/register-sw.js"></script> </head> <!--[if lte IE 10]><body class="page-container baseline-grid js-baseline-grid old-ie"><![endif]--> <!--[if gt IE 10]>--> <body class="page-container baseline-grid js-baseline-grid"> <!--<![endif]--> <div class="old-ie-warning"> <img alt="Fragaria s.r.o." src="/website/assets/img/strawberry.svg"> <h1>Fragaria.cz</h1> <p>We are an <b>agile-thinking</b> company. Following the philosophy, we've decided not to support <b>Internet Explorer prior to version 11</b>. It's just not worth the effort.</p> <p>To see our website in it's full glance, we suggest using <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Microsoft Edge</a>, <a href="https://www.google.com/chrome/">Google Chrome</a>, <a href="https://www.opera.com/download">Opera</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Mozilla Firefox</a>.</p> <p>Thanks for your understanding.</p> </div> <div class="page-container__inner js-sitenav sitenav-wrapper"> <div class="content-block content-block__cover--mobile"> <nav class="sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"> <div class="sitenav__menu"> <a href="/website/" class="sitenav__company typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria</span></a> <a class="sitenav__brand" href="/website/"> <img alt="Fragaria s.r.o." src="/website/assets/img/strawberry.svg"> </a> <button class="hamburger hamburger--collapse js-sitenav-menu-toggle" type="button" aria-label="Menu" aria-controls="navigation" aria-expanded="false"> <span class="hamburger-box"> <span class="hamburger-inner"></span> </span> </button> </div> <ul class="sitenav__linkset"> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/#projects" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Projects</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/#team" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Team</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/blog/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Blog</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/career/" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Career</span></a></li> <li class="sitenav__linkset-item js-sitenav-link"><a href="/website/#get-in-touch" class="sitenav__link typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Contact</span></a></li> </ul> </nav> </div> <div class="sitenav-wrapper__push"> <article itemtype="https://schema.org/TechArticle" itemscope class="article" lang="cs"> <div class="content-block typeset"> <h1 itemprop="name" class="article__headline">Debugujeme v Node.js</h1> <meta itemprop="headline" content="Debugujeme v Node.js"> <div itemprop="publisher" itemtype="http://schema.org/Organization" class="hidden" itemscope> <div itemprop="logo" itemtype="http://schema.org/ImageObject" itemscope=""> <meta itemprop="url" content="https://fragaria.github.com/website/assets/img/strawberry.svg"> </div> <meta itemprop="name" content="Fragaria s.r.o."> </div> <p class="article__meta"> <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author"> by <span itemprop="name">Hynek Urban</span> </span> <meta itemprop="datePublished" content=""/> <span class="article__pubdate">27.05.2015</span> <meta itemprop="publisher"></meta> </p> <div class="article__content-wrap"> <div class="article__content"> <p>Jakožto nově příchozí do světa Node.js jsem se záhy začal zajímat o způsob, jak efektivně ladit kód v Node.js. Donedávna jsem se pohyboval především v prostředí Pythonu, kde jsem byl zvyklý používat <a href="https://docs.python.org/3/library/pdb.html">pdb</a>. Jaké jsou alternativy pro Node.js?</p> <h3 id="výpis-do-konzole">Výpis do konzole</h3> <p>Základní způsob ladění, totiž výpis do konzole, lze s úspěchem použít asi v jakémkoliv programovacím jazyce a na jakékoli platformě. Javascript není výjimkou — <a href="http://www.commonjs.org/">CommonJS</a> definuje modul console, který lze pro výpis použít, typicky asi pomocí funkce <code class="highlighter-rouge">console.log</code>.</p> <p>V případě Node.js je tento modul rovnou dostupný prostřednictvím globální proměnné se stejným názvem (tj. “console”). I když je podle mojí zkušenosti tento způsob debugování dostačující v drtivé většině případů, je natolik jednoduchý, že asi nemá cenu se mu dále věnovat.</p> <h3 id="command-line-debugger">Command-line debugger</h3> <p>Node (nebo spíše <a href="https://en.wikipedia.org/wiki/V8_%28JavaScript_engine%29">V8</a>) obsahuje i vlastní plnohodnotný debugger, který podporuje breakpointy, krokování i watchery. <a href="https://nodejs.org/api/debugger.html#debugger_watchers">Dokumentace</a> je, myslím si, docela pěkná, ale i tak zde použití nodovského debuggeru přiblížím.</p> <h4 id="jak-přistoupit-k-rozhraní-ladícího-nástroje">Jak přistoupit k rozhraní ladícího nástroje</h4> <p>Prvním krokem je spuštění nodovského procesu v debug módu:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node debug app.js
</code></pre></div></div> <p>Pokud náhodou používáte <a href="https://github.com/remy/nodemon">nodemon</a> pro automatické načítání změn kódu, i ten lze takto spustit:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nodemon --debug app.js
</code></pre></div></div> <p>(Existuje rovněž způsob, jak se připojit k již běžícímu Node.js procesu, který můžete najít ve výše zmíněné dokumentaci.)</p> <p>Vykonávání kódu se zastaví na první řádce (výrazu) vaší aplikace a v terminálu uvidíte rozhraní debuggeru. I když už teď lze krokovat, interaktivně vstupovat do běžícího prostředí a podobně, myslím, že užitečnější je nejdřív definovat breakpointy na místech aplikace, která nás blíže zajímají.</p> <h4 id="breakpointy">Breakpointy</h4> <p>Řekněme, že máme tuto jednoduchou funkci:</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">curr</span><span class="p">,</span> <span class="nx">prev</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">curr</span> <span class="o">+</span> <span class="nx">prev</span><span class="p">;</span> <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>Dále si představme, že na nějakém místě v naší aplikaci čekáme, že tato funkce vrátí konkrétní číslo, třeba 90. Jenže ouha, vrácené číslo je 89. Nejjednodušší způsob, jak zjistit proč, je podívat se, jaký argument funkce dostává. To můžeme udělat třeba tak, že na vhodné místo umístíme breakpoint:</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">debugger</span><span class="p">;</span> <span class="c1">// Definováno v ECMAScript 5.</span>
    <span class="k">return</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">curr</span><span class="p">,</span> <span class="nx">prev</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">curr</span> <span class="o">+</span> <span class="nx">prev</span><span class="p">;</span> <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>Po spuštění aplikace v debug módu (a přeskočení úvodního breakpointu pomocí příkazu <code class="highlighter-rouge">cont</code>) se vykonávání kódu zastaví na řádce obsahující výraz “debugger”. Nyní si můžeme prohlédnout, co vlastně funkce dostává za argumenty:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>break in hele.js:2
  1 function foo(bar) {
  2     debugger; // Definováno v ECMAScript 5.
  3     return bar.reduce(function (curr, prev) {return curr + prev; }, 0);
  4 }
debug&gt; repl
Press Ctrl + C to leave debug repl
&gt; bar
[ 27, 16, 35, 11 ]
</code></pre></div></div> <p>Breakpointy můžeme nastavit buď přímo v kódu (jako v příkladu nahoře), nebo v rozhraní běžícího debuggeru pomocí příkazu <code class="highlighter-rouge">setBreakpoint</code>. Všimněte si také příkazu <code class="highlighter-rouge">repl</code>, který jsme zadali, abychom se následně mohli dotázat na obsah proměnné <code class="highlighter-rouge">bar</code>.</p> <h4 id="repl-read-eval-print-loop-během-ladění">REPL (Read-Eval-Print Loop) během ladění</h4> <p>U předchozího příkladu mohlo někoho napadnout, že jednoduchý výpis do konzole by posloužil stejnému účelu i bez debuggeru — a měl by pravdu. Faktem nicméně je, že existují výrazně složitější situace, kde jeden výpis nestačí, a pokud vývojář nemá v zásobě jiný trik, většinou končí u mnohokrát opakovaného pouštění aplikace s různými výpisy ve snaze objevit podstatu problému.</p> <p>To je přesně situace, kde se vyplatí použít příkaz <code class="highlighter-rouge">repl</code>. Ten umožňuje vstup do interaktivního módu — vykonávání programu je stále zastaveno na daném místě (breakpointu), ale přitom můžeme v javascriptové konzoli přistupovat ke všem proměnným/objektům dostupným v aktuálním rámci. Objekty můžeme nejen zkoumat, ale i měnit, přičemž změny zůstanou v platnosti i poté, co se program opět rozběhne (příkaz <code class="highlighter-rouge">cont</code> debuggeru). Myslím, že je evidentní, o jak mocný nástroj pro ladění se jedná.</p> <h4 id="krokování-a-watchery">Krokování a watchery</h4> <p>Alternativou k vypisování proměnných nebo k jejich interaktivnímu zkoumání v REPLu je nastavení watcherů spojené s krokováním. Příkazem <code class="highlighter-rouge">watch("expression")</code> (např. <code class="highlighter-rouge">watch("bar")</code>) můžeme debuggeru říci, aby nám u každého breakpointu (i při každém dalším kroku — příkazy <code class="highlighter-rouge">next</code>, <code class="highlighter-rouge">step</code> a <code class="highlighter-rouge">out</code>, viz dokumentace) ukázal, jaká je hodnota zadaného výrazu.</p> <p>Výhodou oproti obyčejným výpisům je to, že výraz, který nás zajímá, specifikujeme pouze jednou, a potom už jenom pohodlně sledujeme, jak se mění během průchodu aplikací.</p> <h3 id="node-inspector">node-inspector</h3> <p>Debugger popsaný v předchozí sekci je užitečný, ale ze zkušenosti vím, že někteří vývojáři považují prostředí příkazové řádky za nekomfortní. Proto bych chtěl zmínit ještě jeden nástroj, který lze při debugování použít. Jedná se o <a href="https://github.com/node-inspector/node-inspector">node-inspector</a> — npm modul, který umožňuje ladit nodovský kód v Chrome Developer Tools debuggeru.</p> <p>Stačí tento modul nainstalovat (např. <code class="highlighter-rouge">npm install -g node-inspector</code>) a následně jej spustit formou <code class="highlighter-rouge">node-debug app.js</code>. Výsledkem je, že se spustí aplikace a zároveň se otevře Chrome a jeho debugger. Ten lze použít na všechno, co bylo popsáno v minulé sekci, s plným pohodlím grafického uživatelského rozhraní.</p> <figure class="figure content-block__cover--mobile "> <img src="https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_auto,q_auto,dpr_2.0/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png" srcset="https://res.cloudinary.com/fragaria/image/upload/w_480,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 480w, https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 640w, https://res.cloudinary.com/fragaria/image/upload/w_1280,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 1280w, https://res.cloudinary.com/fragaria/image/upload/w_1920,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 1920w, https://res.cloudinary.com/fragaria/image/upload/w_1120,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 1120w, https://res.cloudinary.com/fragaria/image/upload/w_2240,c_limit,f_auto,q_auto/fragaria.cz/posts/2015-05-27-debugujeme-v-nodejs__1.png 2240w," class="figure__image js-fix-baseline"/> </figure> <p>Závěrem bych tak snad jen řekl, že se zdá, že ladit kód v Node.js není o nic těžší nebo jednodušší než na jiných platformách. Alespoň do chvíle, než začnete používat <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">Promises</a>, ale o těch snad zase radši někdy příště.</p> </div> </div> </div> <div class="content-block"> <div class="article__misc"> <div class="article__miscitem"> <div class="taglist " itemscope itemtype="http://schema.org/WebPage"> <a class="taglist__tag anchor anchor--emphasized" href="/website/blog/archive/tag/debug/" itemprop="relatedLink">debug, </a> <a class="taglist__tag anchor anchor--emphasized" href="/website/blog/archive/tag/nodejs/" itemprop="relatedLink">nodejs</a> </div> </div> <div class="article__miscitem"> <div class="sharebox"> <ul class="sharebox__items"> <li class="sharebox__item sharebox__item--twitter"> <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Debugujeme v Node.js&url=https://fragaria.github.com/website/blog/2015/05/27/debugujeme-v-nodejs/&via=&related=" target="_blank" rel="noopener" title="Share on Twitter"><span>Share on Twitter</span></a> </li> <li class="sharebox__item sharebox__item--facebook"> <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.github.com/website/blog/2015/05/27/debugujeme-v-nodejs/" target="_blank" rel="noopener" title="Share on Facebook"><span>Share on Facebook</span></a> </li> <li class="sharebox__item sharebox__item--gplus"> <a class="sharebox__item-body" href="https://plus.google.com/share?url=https://fragaria.github.com/website/blog/2015/05/27/debugujeme-v-nodejs/" target="_blank" rel="noopener" title="Share on Google+"><span>Share on Google+</span></a> </li> </ul> </div> </div> </div> </div> </article> <footer class="content-block"> <div class="footer"> <div class="footer__meta"> <a href="/website/"> <img alt="Fragaria s.r.o." class="footer__brand" src="/website/assets/img/strawberry.svg"> </a> <div class="footer__copy"> <div class="footer__copy-line footer__copy-line--emphasized">FRAGARIA &copy; 2018</div> <div class="footer__copy-line">Talk is cheap, show me the code.</div> </div> </div> <div class="footer__social"> <a href="https://twitter.com/fragariacz" class="icon--twitter footer__social-icon"></a> <a href="https://linkedin.com/company/fragaria-ltd-" class="icon--linkedin footer__social-icon"></a> <a href="https://github.com/fragaria"class="icon--github footer__social-icon"></a> </div> </div> </footer> </div> </div> <script src="/website/assets/js/site.js?584f23011346b069c187ad61a8021139"></script> </body> </html>