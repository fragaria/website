<!DOCTYPE html> <html lang="en" dir="ltr" itemtype="http://schema.org/WebPage" itemscope=""> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <meta name="HandheldFriendly" content="true"/> <title>Runtime configuration in web applications | Fragaria.cz</title> <meta name="author" content="Fragaria s.r.o."/> <meta name="robots" content="index,follow"/> <meta name="description" content="Every time you start to develop a new frontend application, you are happy with a single instance. But then it gains traction and suddenly you are in need of multiple separate installations — be it for QA, demonstrations or other purposes. And you are suddenly facing a new problem: How do I inject the instances with configurat..."> <meta name="keywords" content="software, software development, web apps, vývoj software, webové aplikace, python, javascript, typescript, java, angular, vue, elasticsearch, html, css, javascript, webpack, configuration"/> <meta property="og:url" content="https://fragaria.cz/blog/2019/02/05/runtime-configuration-in-web-applications/"/> <meta property="og:type" content="website"/> <meta property="og:title" content="Runtime configuration in web applications | Fragaria.cz"/> <meta property="og:description" content="Every time you start to develop a new frontend application, you are happy with a single instance. But then it gains traction and suddenly you are in need of multiple separate installations — be it for QA, demonstrations or other purposes. And you are suddenly facing a new problem: How do I inject the instances with configurat..."/> <meta property="og:image" content="https://res.cloudinary.com/fragaria/image/upload/w_640,c_fit,f_jpg,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn"/> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png"> <link rel="manifest" href="/assets/favicons/site.webmanifest"> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#ea272e"> <link rel="shortcut icon" href="/favicon.ico"> <meta name="msapplication-TileColor" content="#ea272e"> <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml"> <meta name="theme-color" content="#ea272e"> <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-9784905-1', 'auto');
    ga('send', 'pageview');
</script> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/AndulkaTextPro.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/AndulkaTextPro-Italic.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="https://res.cloudinary.com/fragaria/raw/upload/v1534234755/fragaria.cz/fonts/TriviaGroteskN2-Bold.woff" as="font" type="font/woff" crossorigin> <link rel="preload" href="/assets/fonts/fragariacz-icons.ttf?3rxsze" as="font" type="font/ttf" crossorigin="anonymous"> <link rel="preload" href="/assets/js/site.js?9168d62dd4a60930fc6eec9260314b54" as="script"> <link rel="stylesheet" href="/assets/styles.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="alternate" type="application/atom+xml" href="/feed.xml" title="Blog | Fragaria.cz"/> <link rel="self" type="application/atom+xml" href="/feed.xml"/> <link rel="preload" href="https://fonts.googleapis.com/css?family=Source+Code+Pro" as="style"> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/> </head> <body class="page-container baseline-grid js-baseline-grid js-ie-warn"> <div class="old-ie-warning"> <img alt="Fragaria s.r.o." src="/assets/img/strawberry.svg"> <h1>Fragaria.cz</h1> <p>We are an <b>agile-thinking</b> company. Following the philosophy, we've decided not to support <b>Internet Explorer</b>. It's just not worth the effort. Since you're using it, you might experience various issues with the site.</p> <p>To see our website in it's full glance, we suggest using <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Microsoft Edge</a>, <a href="https://www.google.com/chrome/">Google Chrome</a>, <a href="https://www.opera.com/download">Opera</a> or <a href="https://www.mozilla.org/en-US/firefox/new/">Mozilla Firefox</a>.</p> <p><strong>Thanks for your understanding</strong>.</p> <span class="button js-ie-warn__dismiss" role="button">Dismiss</span> </div> <nav id="js-sitenav" class="sitenav js-sitenav" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"> <div class="sitenav__container"> <div class="content-block content-block__cover--mobile"> <div class="sitenav__menu js-sitenav-menu"> <a href="/" class="sitenav__company typeset__anchor--nounderline" itemprop="url"><span itemprop="name">Fragaria</span></a> <a class="sitenav__brand" href="/"> <img alt="Fragaria s.r.o." src="/assets/img/strawberry.svg"> </a> <button class="sitenav__menutoggle hamburger hamburger--collapse js-sitenav-menu__toggle" type="button" aria-label="Menu" aria-controls="js-sitenav" aria-expanded="false"> <span class="hamburger-box"> <span class="hamburger-inner"></span> </span> </button> </div> <ul class="sitenav__linkset"> <li class="sitenav__linkset-item js-sitenav__link"><a href="/#projects" class="sitenav__link typeset__anchor--nounderline js-sitenav-menu__anchor" itemprop="url"><span itemprop="name">Projects</span></a></li> <li class="sitenav__linkset-item js-sitenav__link"><a href="/how-we-work/" class="sitenav__link typeset__anchor--nounderline js-sitenav-menu__anchor" itemprop="url"><span itemprop="name">How we work</span></a></li> <li class="sitenav__linkset-item js-sitenav__link"><a href="/blog/" class="sitenav__link typeset__anchor--nounderline js-sitenav-menu__anchor" itemprop="url"><span itemprop="name">Blog</span></a></li> <li class="sitenav__linkset-item js-sitenav__link"><a href="/work-with-us/" class="sitenav__link typeset__anchor--nounderline js-sitenav-menu__anchor" itemprop="url"><span itemprop="name">Work with us</span></a></li> <li class="sitenav__linkset-item js-sitenav__link"><a href="/#get-in-touch" class="sitenav__link typeset__anchor--nounderline js-sitenav-menu__anchor" itemprop="url"><span itemprop="name">Contact</span></a></li> </ul> </div> </div> </nav> <div class="page-container__inner sitenav-wrapper"> <div class="sitenav-wrapper__push"> <article itemtype="https://schema.org/TechArticle" itemscope class="article" lang="en"> <div class="content-block typeset"> <h1 itemprop="name" class="article__headline">Runtime configuration in web applications</h1> <meta itemprop="headline" content="Runtime configuration in web applications"> <div itemprop="publisher" itemtype="http://schema.org/Organization" class="hidden" itemscope> <div itemprop="logo" itemtype="http://schema.org/ImageObject" itemscope=""> <meta itemprop="url" content="https://fragaria.cz/assets/img/strawberry.svg"> </div> <meta itemprop="name" content="Fragaria s.r.o."> </div> <p class="article__meta"> <meta itemprop="datePublished" content=""/> <span class="article__pubdate">February 05, 2019</span> <span itemprop="author" itemtype="http://schema.org/Person" itemscope="" class="article__author"> by <span itemprop="name">Jirka Chadima</span> </span> <meta itemprop="publisher"></meta> </p> <div class="article__content-wrap"> <div class="article__content article-typeset js-auto-add-headline-anchors hypenize"> <p>Every time you start to develop a new frontend application, you are happy with a single instance. But then it gains traction and suddenly you are in need of multiple separate installations — be it for <a href="https://en.wikipedia.org/wiki/Quality_assurance">QA</a>, demonstrations or other purposes. And you are suddenly facing a new problem: How do I inject the instances with configuration values that are different for each environment?</p> <figure class="figure content-block__cover--mobile figure--wide"> <img src="https://res.cloudinary.com/fragaria/image/upload/w_1120,c_limit,f_auto,q_auto,dpr_2.0/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn" srcset="https://res.cloudinary.com/fragaria/image/upload/w_480,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 480w, https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 640w, https://res.cloudinary.com/fragaria/image/upload/w_1290,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 1290w, https://res.cloudinary.com/fragaria/image/upload/w_1920,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 1920w, https://res.cloudinary.com/fragaria/image/upload/w_1120,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 1120w, https://res.cloudinary.com/fragaria/image/upload/w_2240,c_limit,f_auto,q_auto/fragaria.cz/posts/cargo-cargo-container-clouds-1427541_f5dhrn 2240w," class="figure__image js-fix-baseline"/> </figure> <h2 id="traditional-way">Traditional way</h2> <p>In the early days, these values, such as an URL of your API, used to be hardcoded in your application and it was a pain to change them all.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://api.example.com</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// do stuff</span>
  <span class="p">});</span>
</code></pre></div></div> <p>Then it became quite common to put them into a separate file. That led to multiple environment-specific files.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">config</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">ENVIRONMENT</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./config</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// } else if (process.env.ENVIRONMENT === 'staging') {</span>
<span class="c1">// } else if (process.env.ENVIRONMENT === 'qa') {</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./config-dev</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> 
<span class="nx">fetch</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">API_URL</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// do stuff</span>
  <span class="p">});</span>
</code></pre></div></div> <p>Then somebody figured out that having multiple files does not really scale well. If you need a new environment, you need to commit a new file and particularly for short-lived environments that became an unwanted overhead.</p> <p>So the environment variables started to be used directly and the apps became full of calls to <code class="highlighter-rouge">process.env.VARIABLE</code> which is seemingly great and works really well.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_URL</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// do stuff</span>
  <span class="p">});</span>
</code></pre></div></div> <p>And if you combine these things, you end up with something like <a href="https://www.npmjs.com/package/dotenv">dotenv</a>, which is a really nice, portable solution that scales well. There are of course many other flavours of this and an exhaustive list of them can be found in <a href="https://medium.freecodecamp.org/environment-settings-in-javascript-apps-c5f9744282b6">this article</a>.</p> <h2 id="docker-comes-into-play">Docker comes into play</h2> <p>Unfortunately, there is one common issue with all these solutions: <strong>All of the options are resolved during build time.</strong></p> <p>Modern Javascript applications are distributed as optimized packages (built by <a href="https://webpack.js.org/">Webpack</a> or <a href="https://parceljs.org/">Parcel</a>) and that’s perfectly fine. But the <code class="highlighter-rouge">process.env</code> statements get replaced by the actual values during build phase and that’s it.</p> <p>Why is that a problem? Well, if you have many environments and your application is run as, let’s say <a href="https://www.docker.com">Docker</a> containers, you need to have as many builds as there are environments.</p> <p>And that is hell.</p> <p>The typical <code class="highlighter-rouge">Dockerfile</code> for a frontend Javascript application might look like this:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM mhart/alpine-node:10
RUN apk update <span class="o">&amp;&amp;</span> apk upgrade <span class="o">&amp;&amp;</span> apk add <span class="nt">--no-cache</span> bash git openssh
WORKDIR /usr/src/app
COPY package<span class="k">*</span>.json ./
RUN npm <span class="nb">install
</span>COPY <span class="nb">.</span> <span class="nb">.</span>
ARG NODE_ENV
ARG API_URL
RUN npm run build
CMD <span class="o">[</span><span class="s2">"npm"</span>, <span class="s2">"run"</span>, <span class="s2">"start"</span><span class="o">]</span>
</code></pre></div></div> <p>So you install your dependencies, <em>build the application bundle</em> with variables provided by <code class="highlighter-rouge">ARG</code> statements and then start some basic webserver that serves the built artifact to the public.</p> <p>The problem here is, that only the <code class="highlighter-rouge">CMD</code> statement is run during the container startup. Everything else is done during build time. So you have no way of injecting anything into the resulting bundle. That does not really help, does it?</p> <p><em>Sidenote: There are of course some environment variables common to all of your environments such as commit hash, version number etc. Keep them hardcoded with <code class="highlighter-rouge">process.env</code> calls, there is no harm in that.</em></p> <h2 id="environment-agnostic-builds">Environment-agnostic builds</h2> <p>So how can this be solved? We apparently have to populate the configuration during the <code class="highlighter-rouge">CMD</code> statement. But how?</p> <p>The answer is simple: <strong>Don’t include your configuration into your builds.</strong> Cool. But can you give me a simple checklist?</p> <figure class="figure content-block__cover--mobile figure--wide"> <img src="https://res.cloudinary.com/fragaria/image/upload/w_1120,c_limit,f_auto,q_auto,dpr_2.0/fragaria.cz/posts/change-choices-choose-277615_gnx2al" srcset="https://res.cloudinary.com/fragaria/image/upload/w_480,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 480w, https://res.cloudinary.com/fragaria/image/upload/w_640,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 640w, https://res.cloudinary.com/fragaria/image/upload/w_1290,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 1290w, https://res.cloudinary.com/fragaria/image/upload/w_1920,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 1920w, https://res.cloudinary.com/fragaria/image/upload/w_1120,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 1120w, https://res.cloudinary.com/fragaria/image/upload/w_2240,c_limit,f_auto,q_auto/fragaria.cz/posts/change-choices-choose-277615_gnx2al 2240w," class="figure__image js-fix-baseline"/> <figcaption class="figure__caption">Many environments ahead of you</figcaption> </figure> <ol> <li>Change all calls to <code class="highlighter-rouge">process.env</code> to <code class="highlighter-rouge">window.env</code> (Yes, I know that globals are ugly. Deal with it.) or anything you want such as <code class="highlighter-rouge">window.myShinyUnicorn</code>. The only important thing is that it’s something that is provided <strong>by the browser and not your build tool</strong>.</li> <li> <p>Create a config file with defaults, such as <code class="highlighter-rouge">env.js</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">window</span><span class="p">.</span><span class="nx">env</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">API_URL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://api.example.com</span><span class="dl">'</span>
 <span class="p">};</span>
</code></pre></div> </div> </li> <li> <p>Load this file <em>before</em> everything else in your HMTL. Check with your build system where it injects the compiled Javascript files. The config file has to be the first thing your application loads.</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ...
 <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/env.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 ...
</code></pre></div> </div> </li> <li> <p>Change your startup script used in a <code class="highlighter-rouge">Dockerfile</code> so that it replaces the contents of the config file and only <strong>after that</strong> runs the application. We are for instance using a trivial shell script called <code class="highlighter-rouge">build-env-file.sh</code> for that. Make sure that you replace the config file in the actual location that is served by your webserver.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">echo</span> <span class="s2">"window.env = {
   API_URL: </span><span class="se">\"</span><span class="nv">$API_URL</span><span class="se">\"</span><span class="s2">
 };"</span> <span class="o">&gt;</span> ./public/env.js
</code></pre></div> </div> </li> <li> <p>Run your docker images like this:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>docker run <span class="nt">-e</span> <span class="nv">API_URL</span><span class="o">=</span>https://production-api.example.com my-docker-image
 <span class="nv">$ </span>docker run <span class="nt">-e</span> <span class="nv">API_URL</span><span class="o">=</span>https://staging-api.example.com my-docker-image
</code></pre></div> </div> </li> </ol> <p>And that’s it. You have just prepared your application for a happy future-proof multi-environment life.</p> <h2 id="why-is-this-even-a-thing">Why is this even a thing?</h2> <p>Of course this is not a new problem, it has been around at least since <a href="https://stackoverflow.com/questions/5018456/environment-specific-build-vs-loading-environment-specific-properties">Java</a> and basically all other programs that need to be built before they are used by the consumers.</p> <p>In the web community, I believe this has become a topic only after <a href="https://www.heroku.com/">Heroku</a> <a href="https://blog.heroku.com/twelve-factor-apps">published</a> their <a href="https://12factor.net">12 factor methodology</a> in 2013. The methodology basically leads developers towards building reusable artifacts and external configuration is one of the important factors in that venture.</p> <p>Heroku itself <a href="https://github.com/mars/create-react-app-buildpack#compile-time-vs-runtime">supports a variant</a> of a solution described in this article for React based app with <a href="https://github.com/mars/heroku-js-runtime-env"><code class="highlighter-rouge">@mars/heroku-js-runtime-env</code></a> package. It does not use a special file, but rather injects the variables directly into your code. I personally have not used it before, but this approach might be a safer option for you than exposing configuration on a special endpoint.</p> <p>In the end, I really believe that if your applications are running in multiple environments and somewhere in the clouds, you should aspire for single application builds that can be run over and over with different configurations.</p> </div> </div> </div> <div class="content-block"> <div class="article__misc"> <div class="article__miscitem"> <div class="taglist " itemscope itemtype="http://schema.org/WebPage"> <a class="taglist__tag anchor anchor--emphasized" href="/blog/archive/tag/javascript/" itemprop="relatedLink">javascript, </a> <a class="taglist__tag anchor anchor--emphasized" href="/blog/archive/tag/webpack/" itemprop="relatedLink">webpack, </a> <a class="taglist__tag anchor anchor--emphasized" href="/blog/archive/tag/configuration/" itemprop="relatedLink">configuration</a> </div> </div> <div class="article__miscitem"> <div class="sharebox"> <ul class="sharebox__items"> <li class="sharebox__item sharebox__item--twitter"> <a class="sharebox__item-body" href="https://twitter.com/intent/tweet?text=Runtime configuration in web applications&url=https://fragaria.cz/blog/2019/02/05/runtime-configuration-in-web-applications/&via=&related=" target="_blank" rel="noopener" title="Share on Twitter"><span>Share on Twitter</span></a> </li> <li class="sharebox__item sharebox__item--facebook"> <a class="sharebox__item-body" href="https://facebook.com/sharer.php?u=https://fragaria.cz/blog/2019/02/05/runtime-configuration-in-web-applications/" target="_blank" rel="noopener" title="Share on Facebook"><span>Share on Facebook</span></a> </li> </ul> </div> </div> </div> </div> </article> <footer class="content-block"> <div class="footer"> <div class="footer__meta"> <a href="/"> <img alt="Fragaria s.r.o." class="footer__brand" src="/assets/img/strawberry.svg"> </a> <div class="footer__copy"> <div class="footer__copy-line footer__copy-line--emphasized">FRAGARIA &copy; 2023</div> <div class="footer__copy-line">Talk is cheap, show me the code.</div> </div> </div> <div class="footer__social"> <a href="https://www.youtube.com/channel/UCz1zwJ9_6-IVdX6oCvq6T_g" class="icon--youtube footer__social-icon" title="Youtube channel"></a> <a href="https://twitter.com/fragariacz" class="icon--twitter footer__social-icon" title="Twitter profile page"></a> <a href="https://linkedin.com/company/fragaria-ltd" class="icon--linkedin footer__social-icon" title="LinkedIn profile page"></a> <a href="https://github.com/fragaria" class="icon--github footer__social-icon" title="GitHub profile page"></a> <a href="https://stackshare.io/fragaria" class="icon--stackshare footer__social-icon" title="Stackshare profile page"></a> </div> </div> </footer> </div> </div> <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script> <script src="/assets/js/smoothscroll.js"></script> <script src="/assets/js/element-closest.js"></script> <script src="/assets/js/site.js?9168d62dd4a60930fc6eec9260314b54"></script> <script type="text/javascript" src="/assets/js/register-sw.js"></script> </body> </html>